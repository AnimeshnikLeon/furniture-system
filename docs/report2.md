# Отчёт по заданию 2 (подсистема продукции)

## 1. Инициализация фреймворка

- Выбран FastAPI как лёгкий и быстрый фреймворк для REST‑API.
- Структура проекта: `app/` (API и бизнес‑логика), `scripts/` (импорт данных), `db/` (SQL).

## 2. Подключение библиотек

- SQLAlchemy — ORM и работа с PostgreSQL.
- psycopg2-binary — драйвер PostgreSQL.
- FastAPI + Uvicorn — веб‑сервер.
- Jinja2 — HTML‑шаблоны под макет интерфейса.
- Pandas + openpyxl — импорт Excel‑файлов.

## 3. Подключение БД к бэкенду

- В `app/database.py` настроен `engine` и `SessionLocal` с использованием переменных `.env`.
- Контейнер `db` поднимает PostgreSQL и выполняет `db/init.sql`.
- Контейнер `importer` после готовности БД загружает данные из Excel в таблицы.

## 4. Архитектура модулей

- Слой моделей БД: `app/models.py` (SQLAlchemy ORM).
- Слой DTO/схем: `app/schemas.py` (Pydantic).
- Слой API: `app/main.py`.
- Импорт данных вынесен в отдельный модуль `scripts/import_data.py`.

## 5. Архитектура взаимодействия (REST)

Реализованы REST‑эндпоинты:

- `GET /products` — список продукции.
- `POST /products`, `PUT /products/{id}` — мутация данных.
- `GET /workshops` — список цехов.
- `GET /products/{id}/workshops` — маршрут изготовления по цехам.
- `GET /product-cards` — карточки продукции с полным временем изготовления.

Фронтенд использует HTML‑страницу `/`, которая запрашивает данные из БД через те же модели и рендерится шаблоном Jinja2.

## 6. Алгоритм расчёта времени изготовления

- Время изделия = сумма `product_workshop.production_time_hours` по всем цехам.
- Сумма округляется вверх до целого (`ceil`), результат — целое неотрицательное число часов.
- Алгоритм реализован в эндпоинте `GET /product-cards` в `app/main.py`.

## 7. Интерфейс

- Главная страница `/` оформлена в виде карточек, приближённых к макету.
- Заголовок окна и шапка соответствуют назначению приложения.
- Подключены логотип и фавикон из каталога `app/static`.
- Стили заданы в `static/style.css` в едином стиле для всех компонентов.

## 8. Тестирование

- После развёртывания через `docker compose up --build` проверены все эндпоинты через Swagger UI.
- Проверено отсутствие падений при запросах:
  - при отсутствии несуществующих ID возвращается 404;
  - импорт можно повторно запускать без дубликатов (`ON CONFLICT`).
- Вручную сверена сумма времени для нескольких изделий с данными в Excel.
